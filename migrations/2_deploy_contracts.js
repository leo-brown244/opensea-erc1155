const MyCollectible = artifacts.require("MyCollectible");
const MyLootBox = artifacts.require("MyLootBox");

// Set to false if you only want the collectible to deploy
const ENABLE_LOOTBOX = true
// Set to undefined if you want to create your own collectible
const NFT_ADDRESS_TO_USE = '0xfaafdc07907ff5120a76b34b731b278c38d6043c'
// If you want to set preminted token ids for specific classes
const TOKEN_ID_MAPPING = {
  // 88 commons
  0: ['7237005577332281999397856501860761851237635992167078807090459951131355250688', '7237005577332282005674958237247442615073425415374745223192815395595389763584', '10855508365998404845718566014510373763753442071679342842623744536709221580800', '10855508365998404858272769485283735291425020918094675674828455425637290606592', '10855508365998404870826972956057096819096599764510008507033166314565359632384', '10855508365998404883381176426830458346768178610925341339237877203493428658176', '10855508365998404914766685103763862165947125726963673419749654425813601222656', '10855508365998404927320888574537223693618704573379006251954365314741670248448', '10855508365998404952429295516083946748961862266209671916363787092597808300032', '10855508365998405015200312869950754387319756498286336077387341537238153428992', '10855508365998405034031618076110796678827124767909335325694407870630256967680', '10855508365998405040308719811497477442662914191117001741796763315094291480576', '10855508365998405046585821546884158206498703614324668157899118759558325993472', '10855508365998405059140025017657519734170282460740000990103829648486395019264', '10855508365998405065417126753044200498006071883947667406206185092950429532160', '10855508365998405071694228488430881261841861307155333822308540537414464045056', '10855508365998405103079737165364285081020808423193665902820317759734636609536', '10855508365998405109356838900750965844856597846401332318922673204198671122432', '10855508365998405147019449313071050427871334385647330815536805870982878199808', '10855508365998405153296551048457731191707123808854997231639161315446912712704', '10855508365998405159573652783844411955542913232062663647741516759910947225600', '10855508365998405178404957990004454247050281501685662896048583093303050764288', '10855508365998405197236263196164496538557649771308662144355649426695154302976', '10855508365998405203513364931551177302393439194516328560458004871159188815872', '10855508365998405216067568402324538830065018040931661392662715760087257841664', '10855508365998405234898873608484581121572386310554660640969782093479361380352', '10855508365998405297669890962351388759930280542631324801993336538119706509312', '10855508365998405303946992697738069523766069965838991218095691982583741022208', '10855508365998405310224094433124750287601859389046657634198047427047775535104', '10855508365998405329055399639284792579109227658669656882505113760439879073792', '10855508365998405335332501374671473342945017081877323298607469204903913586688', '10855508365998405347886704845444834870616595928292656130812180093831982612480', '10855508365998405360440908316218196398288174774707988963016890982760051638272', '10855508365998405372995111786991557925959753621123321795221601871688120664064', '10855508365998405435766129140858365564317647853199985956245156316328465793024', '10855508365998405467151637817791769383496594969238318036756933538648638357504', '10855508365998405473428739553178450147332384392445984452859288983112672870400', '10855508365998405517368451700885215494182910354899649365575777094360914460672', '10855508365998405529922655171658577021854489201314982197780487983288983486464', '10855508365998405536199756907045257785690278624522648613882843427753017999360', '10855508365998405548753960377818619313361857470937981446087554316681087025152', '10855508365998405586416570790138703896376594010183979942701686983465294102528', '10855508365998405636633384673232150007062909395845311271520530539177570205696', '10855508365998405686850198556325596117749224781506642600339374094889846308864', '10855508365998405705681503762485638409256593051129641848646440428281949847552', '10855508365998405711958605497872319173092382474337308264748795872745984360448', '10855508365998405718235707233258999936928171897544974680851151317210018873344', '10855508365998405730789910704032361464599750743960307513055862206138087899136', '10855508365998405737067012439419042228435540167167973929158217650602122412032', '10855508365998405743344114174805722992271329590375640345260573095066156924928', '10855508365998405774729622851739126811450276706413972425772350317386329489408', '10855508365998405781006724587125807575286066129621638841874705761850364002304', '10855508365998405818669334999445892158300802668867637338488838428634571079680', '10855508365998405831223538470219253685972381515282970170693549317562640105472', '10855508365998405837500640205605934449808170938490636586795904762026674618368', '10855508365998405850054843676379295977479749784905969419000615650954743644160', '10855508365998405868886148882539338268987118054528968667307681984346847182848', '10855508365998405875163250617926019032822907477736635083410037428810881695744', '10855508365998405887717454088699380560494486324151967915614748317738950721536', '10855508365998405906548759294859422852001854593774967163921814651131054260224', '10855508365998405963042674913339549726523959402643964908843013651307364876288', '10855508365998405969319776648726230490359748825851631324945369095771399389184', '10855508365998405975596878384112911254195538249059297741047724540235433902080', '10855508365998405994428183590272953545702906518682296989354790873627537440768', '10855508365998406000705285325659634309538695941889963405457146318091571953664', '10855508365998406006982387061046315073374485365097629821559501762555606466560', '10855508365998406019536590531819676601046064211512962653764212651483675492352', '10855508365998406025813692267206357364881853634720629069866568095947710005248', '10855508365998406032090794002593038128717643057928295485968923540411744518144', '10855508365998406057199200944139761184060800750758961150378345318267882569728', '10855508365998406063476302679526441947896590173966627566480700762731917082624', '10855508365998411618711338496738917942570229712751405817065269113402460995584', '10855508365998411624988440232125598706406019135959072233167624557866495508480', '10855508365998411650096847173672321761749176828789737897577046335722633560064', '10855508365998411656373948909059002525584966251997404313679401780186668072960', '10855508365998411662651050644445683289420755675205070729781757224650702585856', '10855508365998411675205254115219044817092334521620403561986468113578771611648', '10855508365998411681482355850605725580928123944828069978088823558042806124544', '10855508365998411694036559321379087108599702791243402810293534446970875150336', '10855508365998411700313661056765767872435492214451069226395889891434909663232', '10855508365998411712867864527539129400107071060866402058600600780362978689024', '10855508365998411719144966262925810163942860484074068474702956224827013201920', '10855508365998411725422067998312490927778649907281734890805311669291047714816', '10855508365998411731699169733699171691614439330489401306907667113755082227712', '10855508365998411744253373204472533219286018176904734139112378002683151253504', '10855508365998411894903814853752871551344964333888728125568908669819979563008', '10855508365998412378240648478527290366700749920879042165450277893550637056000', '50659039041325845898969881477030985361708692546320998248865664480367182086144'],
  // 28 rares
  1: ['10855508365998404902212481632990500638275546880548340587544943536885532196864', '10855508365998404946152193780697265985126072843002005500261431648133773787136', '10855508365998404983814804193017350568140809382248003996875564314917980864512', '10855508365998404996369007663790712095812388228663336829080275203846049890304', '10855508365998405008923211134564073623483967075078669661284986092774118916096', '10855508365998405190959161460777815774721860348100995728253293982231119790080', '10855508365998405228621771873097900357736596887346994224867426649015326867456', '10855508365998405253730178814644623413079754580177659889276848426871464919040', '10855508365998405266284382285417984940751333426592992721481559315799533944832', '10855508365998405278838585756191346468422912273008325553686270204727602970624', '10855508365998405322778297903898111815273438235461990466402758315975844560896', '10855508365998405460874536082405088619660805546030651620654578094184603844608', '10855508365998405479705841288565130911168173815653650868961644427576707383296', '10855508365998405630356282937845469243227119972637644855418175094713535692800', '10855508365998405655464689879392192298570277665468310519827596872569673744384', '10855508365998405668018893350165553826241856511883643352032307761497742770176', '10855508365998405680573096820938915353913435358298976184237018650425811795968', '10855508365998405699404402027098957645420803627921975432544084983817915334656', '10855508365998405768452521116352446047614487283206306009669994872922294976512', '10855508365998405787283826322512488339121855552829305257977061206314398515200', '10855508365998405862609047147152657505151328631321302251205326539882812669952', '10855508365998405900271657559472742088166065170567300747819459206667019747328', '10855508365998405931657166236406145907345012286605632828331236428987192311808', '10855508365998405937934267971792826671180801709813299244433591873451226824704', '10855508365998405956765573177952868962688169979436298492740658206843330363392', '10855508365998405988151081854886272781867117095474630573252435429163502927872', '10855508365998406050922099208753080420225011327551294734275989873803848056832', '10855508365998406069753404414913122711732379597174293982583056207195951595520'],
  // 22 epics
  2: ['10855508365998404839441464279123692999917652648471676426521389092245187067904', '10855508365998404895935379897603819874439757457340674171442588092421497683968', '10855508365998404921043786839150542929782915150171339835852009870277635735552', '10855508365998404933597990309923904457454493996586672668056720759205704761344', '10855508365998405134465245842297688900199755539231997983332094982054809174016', '10855508365998405140742347577684369664035544962439664399434450426518843686912', '10855508365998405209790466666937858066229228617723994976560360315623223328768', '10855508365998405442043230876245046328153437276407652372347511760792500305920', '10855508365998405498537146494725173202675542085276650117268710760968810921984', '10855508365998405504814248230111853966511331508484316533371066205432845434880', '10855508365998405511091349965498534730347120931691982949473421649896879947776', '10855508365998405592693672525525384660212383433391646358804042427929328615424', '10855508365998405598970774260912065424048172856599312774906397872393363128320', '10855508365998405617802079467072107715555541126222312023213464205785466667008', '10855508365998405749621215910192403756107119013583306761362928539530191437824', '10855508365998405806115131528672530630629223822452304506284127539706502053888', '10855508365998405812392233264059211394465013245659970922386482984170536566784', '10855508365998405881440352353312699796658696900944301499512392873274916208640', '10855508365998406038367895737979718892553432481135961902071278984875779031040', '10855508365998411668928152379832364053256545098412737145884112669114737098752', '10855508365998411706590762792152448636271281637658735642498245335898944176128', '10855508365998411737976271469085852455450228753697067723010022558219116740608'],
  // 9 legendaries
  3: ['10855508365998405002646109399177392859648177651871003245182630648310084403200', '10855508365998405121911042371524327372528176692816665151127384093126740148224', '10855508365998405247453077079257942649243965156969993473174492982407430406144', '10855508365998405272561484020804665704587122849800659137583914760263568457728', '10855508365998405316501196168511431051437648812254324050300402871511810048000', '10855508365998405485982943023951811675003963238861317285063999872040741896192', '10855508365998405649187588144005511534734488242260644103725241428105639231488', '10855508365998405674295995085552234590077645935091309768134663205961777283072', '10855508365998405693127300291712276881585014204714309016441729539353880821760'],
  // 10 divines
  4: ['10855508365998404801778853866803608416902916109225677929907256425460979990528', '10855508365998404833164362543737012236081863225264010010419033647781152555008', '10855508365998404977537702457630669804305019959040337580773208870453946351616', '10855508365998405021477414605337435151155545921494002493489696981702187941888', '10855508365998405027754516340724115914991335344701668909592052426166222454784', '10855508365998405077971330223817562025677650730363000238410895981878498557952', '10855508365998405096802635429977604317185018999985999486717962315270602096640', '10855508365998405115633940636137646608692387269608998735025028648662705635328', '10855508365998411637542643702898960234077597982374405065372335446794564534272', '10855508365998412340578038066207205783686013381633043668836145226766429978624'],
  // 12 hidden
  5: ['10855508365998404877104074691443777582932389187717674923135521759029394145280', '10855508365998404908489583368377181402111336303756007003647298981349566709760', '10855508365998405090525533694590923553349229576778333070615606870806567583744', '10855508365998405172127856254617773483214492078477996479946227648839016251392', '10855508365998405542476858642431938549526068047730315029985198872217052512256', '10855508365998405580139469054752023132540804586976313526599331539001259589632', '10855508365998405762175419380965765283778697859998639593567639428458260463616', '10855508365998405843777741940992615213643960361698303002898260206490709131264', '10855508365998411643819745438285640997913387405582071481474690891258599047168', '10855508365998412321746732860047163492178645112010044420529078893374326439936', '10855508365998412328023834595433844256014434535217710836631434337838360952832', '10855508365998412334300936330820525019850223958425377252733789782302395465728']
}

module.exports = function(deployer, network) {
  // OpenSea proxy registry addresses for rinkeby and mainnet.
  let proxyRegistryAddress
  if (network === 'rinkeby') {
    proxyRegistryAddress = "0xf57b2c51ded3a29e6891aba85459d600256cf317";
  } else {
    proxyRegistryAddress = "0xa5409ec958c83c3f309868babaca7c86dcb077c1";
  }

  if (!ENABLE_LOOTBOX) {
    deployer.deploy(MyCollectible, proxyRegistryAddress, {gas: 5000000});
  } else if (NFT_ADDRESS_TO_USE) {
    deployer.deploy(MyLootBox, proxyRegistryAddress, NFT_ADDRESS_TO_USE, {gas: 5000000})
      .then(setupLootbox);
  } else {
    deployer.deploy(MyCollectible, proxyRegistryAddress, {gas: 5000000}).then(() => {
      return deployer.deploy(MyLootBox, proxyRegistryAddress, MyCollectible.address, {gas: 5000000});
    }).then(setupLootbox);
  }
};

async function setupLootbox() {
  if (!NFT_ADDRESS_TO_USE) {
    const collectible = await MyCollectible.deployed();
    await collectible.transferOwnership(MyLootBox.address);
  }

  if (TOKEN_ID_MAPPING) {
    const lootbox = await MyLootBox.deployed();
    for (const rarity in TOKEN_ID_MAPPING) {
      console.log(`Setting token ids for rarity ${rarity}`)
      const tokenIds = TOKEN_ID_MAPPING[rarity]
      await lootbox.setTokenIdsForClass(rarity, tokenIds);
    }
  }
}
